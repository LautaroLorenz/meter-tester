<app-page-title [title]="title" [headerIcon]="haderIcon"></app-page-title>
<ng-container *ngIf="meters$ | async as meters">
  <app-abm
    [dataset]="meters"
    [columns]="cols"
    [detailFormValid]="form.valid"
    [abmDetailTemplate]="abmDetailTemplate"
    (deleteEvent)="deleteMeters($event)"
    (openDetailEvent)="setFormValues($event)"
    (saveDetailEvent)="saveMeter()"
  >
    <ng-template #abmDetailTemplate>
      <form novalidate [formGroup]="form" class="w-30rem">
        <input type="hidden" formControlName="id" />

        <div class="formgrid grid">
          <div class="col col-6">
            <div class="field">
              <label for="brand_id"
                >Marca<span class="ml-1 text-red-300">*</span>
              </label>
              <p-dropdown
                id="brand_id"
                [options]="dropdownBrandOptions"
                formControlName="brand_id"
                optionValue="id"
                optionLabel="name"
                appendTo="body"
                [required]="true"
                [autoDisplayFirst]="false"
              ></p-dropdown>
              <app-input-error
                [invalid]="form.get('brand_id')?.invalid"
                [dirty]="form.get('brand_id')?.dirty"
                [errors]="form.get('brand_id')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="model"
                >Modelo<span class="ml-1 text-red-300">*</span></label
              >
              <input
                type="text"
                pInputText
                id="model"
                formControlName="model"
                required
              />
              <app-input-error
                [invalid]="form.get('model')?.invalid"
                [dirty]="form.get('model')?.dirty"
                [errors]="form.get('model')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="connection_id"
                >Conexión<span class="ml-1 text-red-300">*</span>
              </label>
              <p-dropdown
                id="connection_id"
                [options]="dropdownConnectionOptions"
                formControlName="connection_id"
                optionValue="id"
                optionLabel="name"
                appendTo="body"
                [required]="true"
                [autoDisplayFirst]="false"
              ></p-dropdown>
              <app-input-error
                [invalid]="form.get('connection_id')?.invalid"
                [dirty]="form.get('connection_id')?.dirty"
                [errors]="form.get('connection_id')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="ratedVoltage" class="mb-2"
                >Tensión nominal (Un) [V]<span class="ml-1 text-red-300"
                  >*</span
                ></label
              >
              <p-inputNumber
                id="ratedVoltage"
                formControlName="ratedVoltage"
                autofocus
                [required]="true"
                [useGrouping]="false"
                [min]="0"
              ></p-inputNumber>
              <app-input-error
                [invalid]="form.get('ratedVoltage')?.invalid"
                [dirty]="form.get('ratedVoltage')?.dirty"
                [errors]="form.get('ratedVoltage')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="maximumCurrent" class="mb-2"
                >Corriente máxima (Imax) [A]<span class="ml-1 text-red-300"
                  >*</span
                ></label
              >
              <p-inputNumber
                id="maximumCurrent"
                formControlName="maximumCurrent"
                autofocus
                [required]="true"
                [useGrouping]="false"
                [min]="0"
              ></p-inputNumber>
              <app-input-error
                [invalid]="form.get('maximumCurrent')?.invalid"
                [dirty]="form.get('maximumCurrent')?.dirty"
                [errors]="form.get('maximumCurrent')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="ratedCurrent" class="mb-2"
                >Corriente nominal (In) [A]<span class="ml-1 text-red-300"
                  >*</span
                ></label
              >
              <p-inputNumber
                id="ratedCurrent"
                formControlName="ratedCurrent"
                autofocus
                [required]="true"
                [useGrouping]="false"
                [min]="0"
              ></p-inputNumber>
              <app-input-error
                [invalid]="form.get('ratedCurrent')?.invalid"
                [dirty]="form.get('ratedCurrent')?.dirty"
                [errors]="form.get('ratedCurrent')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="activeConstantValue" class="mb-2"
                >Constante de energía activa<span class="ml-1 text-red-300"
                  >*</span
                ></label
              >
              <p-inputNumber
                id="activeConstantValue"
                formControlName="activeConstantValue"
                autofocus
                [required]="true"
                [useGrouping]="false"
                [min]="0"
              ></p-inputNumber>
              <app-input-error
                [invalid]="form.get('activeConstantValue')?.invalid"
                [dirty]="form.get('activeConstantValue')?.dirty"
                [errors]="form.get('activeConstantValue')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="activeConstantUnit_id"
                >Unidad de constante activa<span class="ml-1 text-red-300"
                  >*</span
                >
              </label>
              <p-dropdown
                id="activeConstantUnit_id"
                [options]="dropdownActiveConstantUnitOptions"
                formControlName="activeConstantUnit_id"
                optionValue="id"
                optionLabel="name"
                appendTo="body"
                [required]="true"
                [autoDisplayFirst]="false"
              ></p-dropdown>
              <app-input-error
                [invalid]="form.get('activeConstantUnit_id')?.invalid"
                [dirty]="form.get('activeConstantUnit_id')?.dirty"
                [errors]="form.get('activeConstantUnit_id')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="reactiveConstantValue" class="mb-2"
                >Constante de energía reactiva<span class="ml-1 text-red-300"
                  >*</span
                ></label
              >
              <p-inputNumber
                id="reactiveConstantValue"
                formControlName="reactiveConstantValue"
                autofocus
                [required]="true"
                [useGrouping]="false"
                [min]="0"
              ></p-inputNumber>
              <app-input-error
                [invalid]="form.get('reactiveConstantValue')?.invalid"
                [dirty]="form.get('reactiveConstantValue')?.dirty"
                [errors]="form.get('reactiveConstantValue')?.errors"
              ></app-input-error>
            </div>
          </div>

          <div class="col col-6">
            <div class="field">
              <label for="reactiveConstantUnit_id"
                >Unidad de constante reactiva<span class="ml-1 text-red-300"
                  >*</span
                >
              </label>
              <p-dropdown
                id="reactiveConstantUnit_id"
                [options]="dropdownReactiveConstantUnitOptions"
                formControlName="reactiveConstantUnit_id"
                optionValue="id"
                optionLabel="name"
                appendTo="body"
                [required]="true"
                [autoDisplayFirst]="false"
              ></p-dropdown>
              <app-input-error
                [invalid]="form.get('reactiveConstantUnit_id')?.invalid"
                [dirty]="form.get('reactiveConstantUnit_id')?.dirty"
                [errors]="form.get('reactiveConstantUnit_id')?.errors"
              ></app-input-error>
            </div>
          </div>
        </div>
      </form>
    </ng-template>
  </app-abm>
</ng-container>
